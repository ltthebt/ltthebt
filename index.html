<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„ç”µå­æ‰‹è´¦ V2.0</title>
    <style>
        body {
            margin: 0;
            background-color: #fdf6e3; /* ç±³è‰²èƒŒæ™¯ */
            font-family: "Microsoft YaHei", sans-serif;
            /* é˜²æ­¢æ‰‹æœºä¸Šæ‹–åŠ¨æ—¶æ•´ä¸ªé¡µé¢è·Ÿç€åŠ¨ */
            overflow: hidden; 
            touch-action: none; 
        }

        /* é¡¶éƒ¨å·¥å…·æ  */
        #toolbar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap; /* å°å±å¹•è‡ªåŠ¨æ¢è¡Œ */
            justify-content: center;
            gap: 10px;
            z-index: 2000;
            width: 90%;
            max-width: 600px;
        }

        .tool-btn {
            border: none;
            background: #ffecd1;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            white-space: nowrap; /* é˜²æ­¢æŒ‰é’®æ–‡å­—æ¢è¡Œ */
        }

        .tool-btn:hover {
            background: #ffd6a5;
            transform: scale(1.05);
        }
        
        /* éšè—çœŸå®çš„æ–‡ä»¶ä¸Šä¼ æŒ‰é’®ï¼Œå¤ªä¸‘äº† */
        #imageInput {
            display: none;
        }

        /* æ‰‹è´¦å…ƒç´ é€šç”¨æ ·å¼ */
        .item {
            position: absolute;
            cursor: grab; 
            cursor: -webkit-grab;
            user-select: none; /* é˜²æ­¢æ‹–åŠ¨æ—¶é€‰ä¸­æ–‡å­— */
            -webkit-user-select: none;
            animation: popIn 0.3s ease;
            touch-action: none; /* å…³é”®ï¼šå‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªå…ƒç´ ç”±æˆ‘æ¥å¤„ç†è§¦æ§ */
        }
        
        .item:active {
            cursor: grabbing;
            cursor: -webkit-grabbing;
        }

        /* ä¾¿ç­¾æ ·å¼ */
        .note {
            width: 150px;
            min-height: 150px;
            background: #fff740;
            padding: 15px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.15);
            font-size: 16px;
            transform: rotate(-2deg);
            border-radius: 5px;
            /* è®©ä¾¿ç­¾é‡Œçš„æ–‡å­—å¯ä»¥è¢«ç¼–è¾‘ï¼Œä½†ä¸å½±å“æ‹–æ‹½ */
            word-break: break-all;
        }

        /* Emojiæ ·å¼ */
        .sticker {
            font-size: 60px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        /* å›¾ç‰‡æ ·å¼ */
        .image-item img {
            max-width: 250px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢å›¾ç‰‡å¤ªå¤§å æ»¡å±å¹• */
            max-height: 250px;
            border: 5px solid white;
            box-shadow: 3px 3px 12px rgba(0,0,0,0.2);
            transform: rotate(2deg);
            pointer-events: none; /* è®©å›¾ç‰‡æœ¬èº«ä¸å“åº”ç‚¹å‡»ï¼Œè€Œæ˜¯å®ƒçš„å®¹å™¨å“åº” */
        }

        @keyframes popIn {
            from { transform: scale(0) rotate(0); opacity: 0;}
            to { transform: scale(1) rotate(var(--rotation)); opacity: 1;}
        }
    </style>
</head>
<body>

    <div id="toolbar">
        <button class="tool-btn" onclick="createNote()">ğŸ“ ä¾¿ç­¾</button>
        <button class="tool-btn" onclick="createEmoji()">ğŸ˜Š è¡¨æƒ…</button>
        <button class="tool-btn" onclick="document.getElementById('imageInput').click()">ğŸ–¼ï¸ ä¸Šä¼ å›¾ç‰‡</button>
        <button class="tool-btn" style="background:#ffcccb" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
    </div>

    <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">


    <script>
        // --- åŠŸèƒ½å‡½æ•°åŒº ---

        // 1. åˆ›å»ºä¾¿ç­¾
        function createNote() {
            const note = document.createElement('div');
            note.className = 'item note';
            note.contentEditable = true; 
            note.innerText = "ç‚¹æˆ‘å†™å­—...";
            placeRandomly(note);
            addDragFunction(note); 
            document.body.appendChild(note);
        }

        // 2. åˆ›å»ºè¡¨æƒ…
        function createEmoji() {
            const emojis = ['ğŸŒ¸', 'âœ¨', 'ğŸ‚', 'ğŸ±', 'ğŸ¶', 'ğŸ“·', 'ğŸ‰', 'ğŸŒ¿', 'ğŸ“', 'ğŸ§¸'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            const sticker = document.createElement('div');
            sticker.className = 'item sticker';
            sticker.innerText = randomEmoji;
            placeRandomly(sticker);
            addDragFunction(sticker);
            document.body.appendChild(sticker);
        }
        
        // 3. å¤„ç†å›¾ç‰‡ä¸Šä¼  (æ–°åŠŸèƒ½!)
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // ä½¿ç”¨ FileReader è¯»å–ç”¨æˆ·é€‰ä¸­çš„å›¾ç‰‡
            const reader = new FileReader();
            reader.onload = function(e) {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'item image-item';
                
                const img = document.createElement('img');
                img.src = e.target.result; // å›¾ç‰‡çš„æ•°æ®
                
                imgContainer.appendChild(img);
                placeRandomly(imgContainer);
                addDragFunction(imgContainer);
                document.body.appendChild(imgContainer);
            };
            reader.readAsDataURL(file);
            // æ¸…ç©ºinputï¼Œè¿™æ ·ä¸‹æ¬¡é€‰åŒä¸€å¼ å›¾ä¹Ÿèƒ½è§¦å‘onchange
            event.target.value = ''; 
        }

        // 4. æ¸…ç©ºç”»å¸ƒ
        function clearAll() {
            if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')){
                const items = document.querySelectorAll('.item');
                items.forEach(item => item.remove());
            }
        }

        // --- è¾…åŠ©å·¥å…·åŒº ---
        
        // éšæœºæ”¾ç½®å…ƒç´ ï¼Œå¹¶ç»™ä¸€ä¸ªéšæœºæ—‹è½¬è§’åº¦
        function placeRandomly(element) {
            const rotation = Math.random() * 20 - 10; // -10åº¦åˆ°10åº¦ä¹‹é—´
            element.style.setProperty('--rotation', `${rotation}deg`);
            element.style.transform = `rotate(${rotation}deg)`;
            // ç®€å•çš„å±…ä¸­åéšæœºä½ç½®
            element.style.left = (window.innerWidth / 2 - 100 + Math.random() * 200) + 'px';
            element.style.top = (window.innerHeight / 2 - 100 + Math.random() * 200) + 'px';
        }


        // --- æ ¸å¿ƒé­”æ³•ï¼šå…¨å¹³å°æ‹–æ‹½åŠŸèƒ½ (é‡è¦å‡çº§!) ---
        function addDragFunction(element) {
            let isDragging = false;
            let startX, startY, initialLeft, initialTop;

            // è·å–é¼ æ ‡æˆ–æ‰‹æŒ‡çš„ä½ç½®
            function getClientCoords(e) {
                if (e.touches && e.touches.length > 0) {
                    return { x: e.touches[0].clientX, y: e.touches[0].clientY }; // æ‰‹æŒ‡ä½ç½®
                } else {
                    return { x: e.clientX, y: e.clientY }; // é¼ æ ‡ä½ç½®
                }
            }

            // å¼€å§‹æ‹–åŠ¨ (æŒ‰ä¸‹é¼ æ ‡ æˆ– æ‰‹æŒ‡è§¦ç¢°)
            function startDrag(e) {
                // å¦‚æœæ˜¯ä¾¿ç­¾ï¼Œä¸”ç‚¹å‡»çš„æ˜¯æ­£åœ¨è¾“å…¥æ–‡å­—çš„åŒºåŸŸï¼Œå°±ä¸æ‹–åŠ¨
                if (element.isContentEditable && document.activeElement === element) {
                     return;
                }
                
                isDragging = true;
                const coords = getClientCoords(e);
                startX = coords.x;
                startY = coords.y;
                initialLeft = element.offsetLeft;
                initialTop = element.offsetTop;
                
                element.style.zIndex = 9999; // æ‹–åŠ¨æ—¶è®©å®ƒæµ®åœ¨æœ€ä¸Šé¢
                element.style.transition = 'none'; // æ‹–åŠ¨æ—¶å…³é—­è¿‡æ¸¡åŠ¨ç”»ï¼Œæ›´è·Ÿæ‰‹
            }

            // æ‹–åŠ¨ä¸­ (é¼ æ ‡ç§»åŠ¨ æˆ– æ‰‹æŒ‡åœ¨å±å¹•ä¸Šåˆ’åŠ¨)
            function doDrag(e) {
                if (!isDragging) return;
                
                // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆæ¯”å¦‚å±å¹•æ»šåŠ¨ï¼‰é‡è¦ï¼
                if (e.cancelable) e.preventDefault(); 

                const coords = getClientCoords(e);
                const dx = coords.x - startX;
                const dy = coords.y - startY;
                element.style.left = `${initialLeft + dx}px`;
                element.style.top = `${initialTop + dy}px`;
            }

            // ç»“æŸæ‹–åŠ¨ (æ¾å¼€é¼ æ ‡ æˆ– æ‰‹æŒ‡ç¦»å¼€å±å¹•)
            function stopDrag() {
                if (isDragging) {
                    isDragging = false;
                    element.style.zIndex = ''; // æ¢å¤å±‚çº§
                    element.style.transition = 'all 0.2s'; // æ¢å¤åŠ¨ç”»æ•ˆæœ
                }
            }

            // --- ç›‘å¬é¼ æ ‡äº‹ä»¶ (ç”µè„‘ç”¨) ---
            element.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', doDrag);
            document.addEventListener('mouseup', stopDrag);

            // --- ç›‘å¬è§¦å±äº‹ä»¶ (æ‰‹æœº/å¹³æ¿ç”¨) ---
            // passive: false æ˜¯ä¸ºäº†èƒ½ä½¿ç”¨ preventDefault() é˜»æ­¢å±å¹•æ»šåŠ¨
            element.addEventListener('touchstart', startDrag, {passive: false}); 
            document.addEventListener('touchmove', doDrag, {passive: false});
            document.addEventListener('touchend', stopDrag);
        }
    </script>
</body>
</html>
